"use strict";(()=>{(function(){var N=document,x=window;function C(n,r){try{var t=getComputedStyle(document.documentElement).getPropertyValue(n).trim();return t||r}catch(a){return r}}function Z(n){try{var r=parseFloat(n);return isFinite(r)?Math.max(0,Math.min(1,r)):0}catch(t){return 0}}var d={primary:C("--color-primary-main","#2563eb"),primaryDark:C("--color-primary-dark","#1e40af"),bgPaper:C("--color-background-paper","#ffffff"),bgDefault:C("--color-background-default","#ffffff"),textPrimary:C("--color-text-primary","#111827"),textInverse:"#ffffff",border:C("--color-border-main","#e5e7eb"),muted:"#6b7280"},le=`
.scw-btn{position:fixed;right:16px;bottom:16px;background:`+d.primary+";color:"+d.textInverse+`;border-radius:999px;padding:12px 16px;font:14px sans-serif;cursor:pointer;z-index:2147483000;box-shadow:0 8px 20px rgba(0,0,0,.15)}
.scw-badge{position:absolute;top:-4px;right:-4px;background:#ef4444;color:#fff;border-radius:999px;min-width:18px;height:18px;display:none;align-items:center;justify-content:center;font:11px sans-serif;padding:0 5px}
.scw-panel{position:fixed;right:16px;bottom:64px;width:380px;height:600px;background:`+d.bgPaper+";border:1px solid "+d.border+`;border-radius:12px;box-shadow:0 16px 30px rgba(0,0,0,.2);display:none;flex-direction:column;overflow:hidden;z-index:2147483000}
.scw-head{padding:10px 12px;background:`+d.primaryDark+";color:"+d.textInverse+`;font:600 14px sans-serif;display:flex;justify-content:space-between;align-items:center}
.scw-head .scw-actions{display:flex;gap:10px;align-items:center}
.scw-edit{cursor:pointer;opacity:.9}
.scw-edit:hover{opacity:1}
.scw-name-edit{display:flex;gap:6px;align-items:center;margin-left:8px}
.scw-name-edit input{width:160px;padding:4px 6px;border-radius:6px;border:1px solid `+d.border+";font:12px sans-serif;background:"+d.bgDefault+";color:"+d.textPrimary+`}
.scw-name-btn{background:#10b981;border:0;color:#fff;padding:4px 8px;border-radius:6px;cursor:pointer;font:12px sans-serif}
.scw-name-cancel{background:`+d.muted+`}
.scw-banner{display:none;background:`+d.primaryDark+";color:"+d.textInverse+";font:12px sans-serif;padding:6px 8px;border-bottom:1px solid "+d.border+`}
.scw-body{flex:1;overflow:auto;padding:8px;background:`+C("--color-background-default","#f9fafb")+`}
.scw-msg{margin:6px 0;max-width:84%;padding:8px 10px;border-radius:10px;font:14px sans-serif;display:flex;gap:8px;align-items:flex-end;flex-direction:column;word-break:break-word;overflow-wrap:anywhere}
.scw-line{white-space:pre-wrap;word-break:break-word;overflow-wrap:anywhere}
.scw-in{background:`+d.primary+";color:"+d.textInverse+`;margin-left:auto;align-items:flex-end}
.scw-out{background:`+d.border+";color:"+d.textPrimary+`;margin-right:auto;align-items:flex-start}
.scw-time{opacity:.7;font:11px sans-serif}
.scw-agent{opacity:.85;font:11px sans-serif;margin-bottom:2px}
.scw-input{display:flex;border-top:1px solid `+d.border+`}
.scw-input textarea{flex:1;border:0;padding:10px;font:14px sans-serif;outline:none;background:`+d.bgDefault+";color:"+d.textPrimary+`;resize:none;min-height:38px;max-height:140px;line-height:1.35;white-space:pre-wrap;word-break:break-word;overflow-wrap:anywhere}
.scw-input button{border:0;background:`+d.primary+";color:"+d.textInverse+`;padding:0 12px;font:14px sans-serif;cursor:pointer}
.scw-retry{cursor:pointer;color:#fde68a;margin-left:8px;text-decoration:underline}
@media (max-width: 480px){.scw-panel{width:92vw;height:70vh}}
`;function c(n,r,t){var a=N.createElement(n);return r&&(a.className=r),t!=null&&(a.textContent=String(t)),a}function pe(){var n=c("style");n.textContent=le,N.head.appendChild(n)}function ee(n){try{var r=("; "+document.cookie).split("; "+n+"=");if(r.length===2)return r.pop().split(";").shift()}catch(t){}return""}function D(n,r,t){try{var a=new Date;a.setTime(a.getTime()+(t||30)*24*60*60*1e3),document.cookie=n+"="+encodeURIComponent(r)+"; expires="+a.toUTCString()+"; path=/"}catch(l){}}function te(n){try{var r=new Date(n);return r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(t){return""}}function j(n,r,t,a,l){var f=c("div","scw-msg "+(r==="IN"?"scw-in":"scw-out"));if(r==="OUT"&&l){var b=c("div","scw-agent",l+":");f.appendChild(b)}var u=c("div","scw-line");u.textContent=t;var m=c("div","scw-time",te(a||Date.now()));f.appendChild(u),f.appendChild(m),n.appendChild(f),n.scrollTop=n.scrollHeight}function ne(n,r,t){var a=c("div","scw-msg scw-out"),l=c("div","scw-agent"),f=c("div","scw-line");l.textContent="",f.textContent=r;var b=c("div","scw-time",te(t||Date.now()));a.style.opacity=".9",a.style.background="transparent",a.style.border="0",a.style.margin="10px 0",a.appendChild(f),a.appendChild(b),n.appendChild(a),n.scrollTop=n.scrollHeight}function we(n,r){return fetch(n+"/v1/conversations/start",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(r?{name:r}:{})}).then(function(t){if(!t.ok)throw new Error("start failed");return t.json()})}function he(n,r,t,a,l){var f=new WebSocket(n.replace(/^http/,"ws")+"/v1/ws?token="+encodeURIComponent(r));return f.onmessage=function(b){try{var u=JSON.parse(b.data);if(u&&u.type==="agent_joined"){t("SYS",u.agent?u.agent+" joined":"Support joined",Date.now(),null,!0);return}if(u&&u.type==="info_note"){t("SYS",u.text||"",Date.now());return}u&&typeof u.text=="string"&&t(u.direction==="OUTBOUND"?"OUT":"IN",u.text,Date.now(),u.agent)}catch(m){}},f.onopen=function(){a&&a()},f.onclose=function(){l&&l()},f.onerror=function(){try{f.close()}catch(b){}},f}function me(n,r,t,a){return fetch(n+"/v1/conversations/"+encodeURIComponent(r)+"/name",{method:"PATCH",headers:{"content-type":"application/json",authorization:"Bearer "+t},body:JSON.stringify({name:a})}).then(function(l){if(!l.ok)throw new Error("rename failed");return l.json()})}function ve(){try{var n=document.currentScript&&document.currentScript.src;if(!n){var r=document.getElementsByTagName("script");r&&r.length&&(n=r[r.length-1].src)}if(n){var t=new URL(n);return t.origin}}catch(a){}return""}function ge(n){pe();var r=(n&&n.origin||ve()).replace(/\/$/,""),t=x.localStorage||{getItem:function(){},setItem:function(){}};function a(e,i){try{var o=t.getItem(e);return o==null||o===""?i:o}catch(s){return i}}function l(e,i){try{t.setItem(e,i)}catch(o){}}var f=n&&typeof n.showSoundToggle=="boolean"?!!n.showSoundToggle:!0,b=n&&typeof n.showVibrationToggle=="boolean"?!!n.showVibrationToggle:!0,u=n&&typeof n.soundVolume=="number"?Z(n.soundVolume):null;u!=null&&l("scw:notify:volume",String(u));var m=c("div","scw-btn","Chat"),Y=c("div","scw-badge","0");m.style.position="fixed",m.style.bottom="16px";var A=(n&&n.position||"right")==="left"?"left":"right";m.style[A]="16px",m.style[A==="right"?"left":"right"]="auto",m.appendChild(Y);var w=c("div","scw-panel");w.style[A]="16px",w.style[A==="right"?"left":"right"]="auto";var U=c("div","scw-head"),F=c("div","","Support"),I=c("div","scw-actions"),ie=c("div","scw-edit","\u270E"),S=f?c("div","scw-edit"):null,T=b?c("div","scw-edit"):null,re=c("div","scw-edit","_"),oe=c("div","scw-edit","\xD7");function J(){var e=String(a("scw:notify:sound","0"))==="1",i=String(a("scw:notify:vibrate","0"))==="1";S&&(S.textContent=e?"\u{1F514}":"\u{1F515}",S.title=e?"Sound on":"Sound off"),T&&(T.textContent=i?"\u{1F4F3}":"\u{1F507}",T.title=i?"Vibration on":"Vibration off")}S&&(S.onclick=function(){var e=String(a("scw:notify:sound","0"))==="1";l("scw:notify:sound",e?"0":"1"),J()}),T&&(T.onclick=function(){var e=String(a("scw:notify:vibrate","0"))==="1";l("scw:notify:vibrate",e?"0":"1"),J()}),J(),I.appendChild(ie),S&&I.appendChild(S),T&&I.appendChild(T),I.appendChild(re),I.appendChild(oe),U.appendChild(F),U.appendChild(I);var g=c("div","scw-banner","Reconnecting\u2026"),v=c("div","scw-body"),q=c("div","scw-input"),h=c("textarea");h.placeholder="Type a message\u2026";var G=c("button","","Send");q.appendChild(h),q.appendChild(G),w.appendChild(U),w.appendChild(g),w.appendChild(v),w.appendChild(q),N.body.appendChild(m),N.body.appendChild(w);function O(e,i){if(g.style.display="block",g.textContent=e,i){var o=c("span","scw-retry","Retry");o.onclick=function(){R(!0)},g.appendChild(o)}}function ye(){g.style.display="none",g.textContent="";try{for(;g.firstChild;)g.removeChild(g.firstChild)}catch(e){}}var Te=null,_e=null,De="";function Oe(e){}function Ee(){}var y=null;function xe(){var e=Z(a("scw:notify:volume","1"));return e}function be(){try{y=y||new(x.AudioContext||x.webkitAudioContext);var e=y.createOscillator(),i=y.createGain();e.type="sine",e.frequency.value=880;var o=.08*xe();i.gain.setValueAtTime(1e-4,y.currentTime),i.gain.exponentialRampToValueAtTime(Math.max(2e-4,o),y.currentTime+.01),i.gain.exponentialRampToValueAtTime(1e-4,y.currentTime+.2),e.connect(i),i.connect(y.destination),e.start(),e.stop(y.currentTime+.22)}catch(s){}}function ke(){try{navigator.vibrate&&navigator.vibrate(20)}catch(e){}}function Ce(){try{var e=w.style.display==="flex";return!e||!N.hasFocus()}catch(i){return!0}}var _=null,L=!1,M=[],B=0,E=0,H="";function W(){Y.style.display=B>0?"flex":"none",Y.textContent=String(B)}function Ie(){var e=parseInt(t.getItem("scw:ts")||"0",10)||0,i=30*24*60*60*1e3;e&&Date.now()-e>i&&(t.removeItem("scw:id"),t.removeItem("scw:token"))}Ie();function P(e){var i=t.getItem("scw:id")||ee("scw_id"),o=t.getItem("scw:token")||ee("scw_token");return!e&&i&&o?(t.setItem("scw:id",i),t.setItem("scw:token",o),Promise.resolve({conversation_id:i,token:o})):we(r,t.getItem("scw:name")||void 0).then(function(s){return t.setItem("scw:origin",r),t.setItem("scw:id",s.conversation_id),t.setItem("scw:token",s.token),D("scw_id",s.conversation_id,30),D("scw_token",s.token,30),t.setItem("scw:ts",String(Date.now())),{conversation_id:s.conversation_id,token:s.token}})}function ae(){var e=t.getItem("scw:name");F.textContent=e?"Support \u2014 "+e:"Support"}ae();function ce(){try{t.removeItem("scw:id"),t.removeItem("scw:token"),D("scw_id","",-1),D("scw_token","",-1)}catch(e){}}function se(){var e=t.getItem("scw:id");return e?fetch(r+"/v1/conversations/"+encodeURIComponent(e)+"/messages").then(function(i){if(i.status===404)throw new Error("gone");if(!i.ok)throw new Error("bad");return i.json()}).then(function(i){var o=i.status,s=i.messages||[];v.innerHTML="",s.forEach(function(p){j(v,p.direction==="INBOUND"?"IN":"OUT",p.text,new Date(p.createdAt).getTime(),p.agent)}),o==="CLOSED"&&ne(v,"Conversation closed. Start new?",Date.now())}).catch(function(){return ce(),P(!0).then(function(i){return v.innerHTML="",fetch(r+"/v1/conversations/"+encodeURIComponent(i.conversation_id)+"/messages").then(function(o){if(o.ok)return o.json()}).then(function(o){if(o){var s=o.messages||[];s.forEach(function(p){j(v,p.direction==="INBOUND"?"IN":"OUT",p.text,new Date(p.createdAt).getTime(),p.agent)})}})})}):Promise.resolve()}function K(e){if(!L){if(L=!0,_&&_.readyState===1){L=!1;return}navigator.onLine?O(E>0?"Reconnecting\u2026":"Connecting\u2026",!0):O("Offline. Check your connection.",!0),_=he(r,e,function(i,o,s,p,V){if(i==="SYS"){ne(v,o,s),V&&void 0;return}if(i==="IN"&&H&&o===H){H="";return}i==="OUT"&&void 0,j(v,i,o,s,p),w.style.display!=="flex"&&i==="OUT"&&(B++,W()),i==="OUT"&&Ce()&&(String(a("scw:notify:sound","0"))==="1"&&be(),String(a("scw:notify:vibrate","0"))==="1"&&ke())},function(){for(L=!1,E=0,ye();M.length;)try{_.send(M.shift())}catch(i){}},function(){if(L=!1,E++,navigator.onLine?(O("Reconnecting\u2026",!0),void 0):O("Offline. Check your connection.",!0),E>=3)ce(),P(!0).then(function(o){se().then(function(){K(o.token)})});else{var i=Math.min(1e4,500*E);setTimeout(function(){R()},i)}})}}function R(e){P(!1).then(function(i){e&&(E=0),K(i.token)})}function Se(e){if(_&&_.readyState===1)try{_.send(e)}catch(i){M.push(e),R(!0)}else M.push(e),R(!0);H=e,j(v,"IN",e,Date.now())}function de(){w.style.display="flex",t.setItem("scw:ts",String(Date.now())),t.setItem("scw:open","1"),B=0,W(),P(!1).then(function(e){se().then(function(){K(e.token)})})}function $(){w.style.display="none";try{t.removeItem("scw:open")}catch(e){}}function ue(){try{t.removeItem("scw:id"),t.removeItem("scw:token"),t.removeItem("scw:name"),t.removeItem("scw:draft"),D("scw_id","",-1),D("scw_token","",-1)}catch(e){}v.innerHTML="",F.textContent="Support",B=0,W()}m.onclick=function(){w.style.display==="flex"?$():de()},re.onclick=$,oe.onclick=function(){w.style.display==="none"?ue():confirm("Clear chat history and start new?")&&(ue(),$())};var Q=!1;ie.onclick=function(){Q||(Q=!0,P(!1).then(function(e){var i=t.getItem("scw:name")||"",o=c("div","scw-name-edit"),s=c("input");s.value=i,s.placeholder="Your name";var p=c("button","scw-name-btn","Save"),V=c("button","scw-name-btn scw-name-cancel","Cancel");o.appendChild(s),o.appendChild(p),o.appendChild(V),U.insertBefore(o,I);function z(){try{U.removeChild(o)}catch(k){}Q=!1}V.onclick=z,p.onclick=function(){var k=s.value.trim();if(!k){z();return}me(r,t.getItem("scw:id"),t.getItem("scw:token")||"",k).then(function(){t.setItem("scw:name",k),ae(),z()}).catch(function(){alert("Could not update name right now. Please try later."),z()})},s.addEventListener("keydown",function(k){k.key==="Enter"&&p.onclick(),k.key==="Escape"&&V.onclick()}),setTimeout(function(){try{s.focus(),s.select()}catch(k){}},0)}))};try{t.getItem("scw:open")==="1"&&de()}catch(e){}function X(){h.style.height="auto";var e=Math.min(140,Math.max(38,h.scrollHeight));h.style.height=e+"px"}h.addEventListener("input",function(){t.setItem("scw:draft",h.value||""),X()}),G.onclick=function(){var e=h.value.trim();e&&(h.value="",t.removeItem("scw:draft"),X(),Se(e))},h.addEventListener("keydown",function(e){e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),G.onclick())});var fe=t.getItem("scw:draft");fe&&(h.value=fe,setTimeout(X,0));try{x.addEventListener("offline",function(){O("Offline. Check your connection.",!0)}),x.addEventListener("online",function(){O("Connecting\u2026",!0),R(!0)})}catch(e){}}x.SupportChat=x.SupportChat||{},x.SupportChat.init=ge})();})();
